<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>リリースノート - BloSke</title>
    
    <!-- アイコン設定 -->
    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">

    <!-- 共通スタイル -->
    <link rel="stylesheet" href="common.css">

    <!-- Firebase SDK (common.js より先に読み込む) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <!-- marked.js (Markdown -> HTML) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

    <main>
        <div class="content-page">
            <h1>リリースノート</h1>
            
            <div id="loading-releases" style="text-align: center; padding: 20px;">
                <p>リリース情報を読み込んでいます...</p>
            </div>
            
            <div id="release-notes-container">
                <!-- GitHub APIから取得した内容がここに入ります -->
            </div>
        </div>
    </main>

    <!-- 共通スクリプト -->
    <script src="common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 共通UIを初期化
            initCommonUI('BloSke');

            // --- GitHub Releases API から情報を取得 (仕様書 3.2.9) ---
            const GITHUB_REPO = 'qcda-dev/BloSke'; // リポジトリ名
            const API_URL = `https://api.github.com/repos/${GITHUB_REPO}/releases`;

            const container = document.getElementById('release-notes-container');
            const loading = document.getElementById('loading-releases');

            fetch(API_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`GitHub API エラー: ${response.status}`);
                    }
                    return response.json();
                })
                .then(releases => {
                    loading.style.display = 'none';
                    if (releases.length === 0) {
                        container.innerHTML = '<p>リリース情報はまだありません。</p>';
                        return;
                    }

                    releases.forEach(release => {
                        const releaseDate = new Date(release.published_at).toLocaleString('ja-JP');
                        
                        const entry = document.createElement('div');
                        entry.className = 'release-entry';
                        
                        // marked.js を使って Markdown を HTML に変換
                        const bodyHtml = marked.parse(release.body);
                        
                        entry.innerHTML = `
                            <div class="release-header">
                                <h2 class="release-title">${release.name || release.tag_name}</h2>
                                <span class="release-date">${releaseDate}</span>
                            </div>
                            <div class="release-body">
                                ${bodyHtml}
                            </div>
                        `;
                        container.appendChild(entry);
                    });
                })
                .catch(error => {
                    loading.style.display = 'none';
                    console.error('リリースノートの取得に失敗:', error);
                    container.innerHTML = '<p style="color: red;">リリースノートの取得に失敗しました。</p>';
                });
        });
    </script>
</body>
</html>
