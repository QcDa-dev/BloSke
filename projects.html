<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>保存データ一覧 - BloSke</title>
    
    <!-- アイコン設定 -->
    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">

    <!-- 共通スタイル -->
    <link rel="stylesheet" href="common.css">
</head>
<body>
    <!-- 共通UI (ヘッダー, フッター, メニュー) は common.js が自動挿入 -->

    <main>
        <div class="content-page" style="max-width: 600px;">
            <h1>保存済みプロジェクト</h1>
            
            <div id="user-info" class="user-info-bar">
                <i class="fa-solid fa-user"></i>
                <span id="username-display">読み込み中...</span>
            </div>

            <div id="loading-indicator" class="text-center" style="margin: 30px 0;">
                <p><i class="fa-solid fa-spinner fa-spin"></i> プロジェクト一覧を読み込んでいます...</p>
            </div>
            
            <div id="projects-list-container" class="projects-list">
                <!-- 
                <div class="project-item">
                    <span>My Project 1</span>
                    <button class="btn btn-primary btn-sm"><i class="fa-solid fa-download"></i> 読込</button>
                </div>
                -->
            </div>
            
            <div id="no-projects-message" class="text-center hidden" style="margin: 30px 0; color: #555;">
                <p>保存されているプロジェクトはありません。</p>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <a href="index.html" class="btn btn-secondary">
                    <i class="fa-solid fa-arrow-left"></i> メイン画面に戻る
                </a>
            </div>
        </div>
    </main>

    <!-- 共通スクリプト -->
    <script src="common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 共通UIの初期化
            initCommonUI('BloSke');

            const usernameDisplay = document.getElementById('username-display');
            const loadingIndicator = document.getElementById('loading-indicator');
            const listContainer = document.getElementById('projects-list-container');
            const noProjectsMessage = document.getElementById('no-projects-message');

            // --- ログイン状態の確認 ---
            // TODO: 本来はFirebase AuthやSessionStorageからユーザー情報を取得
            const mockUser = { username: 'TestUser' }; // ダミー
            
            if (mockUser) {
                usernameDisplay.textContent = `${mockUser.username} さんのプロジェクト`;
                // プロジェクト一覧を取得
                fetchProjects(mockUser.username);
            } else {
                // 未ログインの場合、login.htmlへリダイレクト (仕様書 3.2.7)
                // alert('ログインが必要です。');
                // window.location.href = 'login.html';
                
                // ダミー表示
                usernameDisplay.textContent = `ログインしていません`;
                loadingIndicator.style.display = 'none';
                noProjectsMessage.classList.remove('hidden');
            }

            // --- プロジェクト一覧の取得 (ダミー) ---
            function fetchProjects(username) {
                // TODO: listProjects APIを呼び出す
                console.log(`API call: listProjects (user: ${username})`);
                
                // ダミーデータによるシミュレーション
                setTimeout(() => {
                    const mockProjects = ['プロジェクトA', '旅行計画2025', '会議タイムテーブル'];
                    // const mockProjects = []; // データがない場合のテスト
                    
                    loadingIndicator.style.display = 'none';
                    
                    if (mockProjects.length === 0) {
                        noProjectsMessage.classList.remove('hidden');
                        return;
                    }
                    
                    mockProjects.forEach(projectName => {
                        const item = document.createElement('div');
                        item.className = 'project-item';
                        
                        const nameSpan = document.createElement('span');
                        nameSpan.textContent = projectName;
                        
                        const loadButton = document.createElement('button');
                        loadButton.className = 'btn btn-primary btn-sm';
                        loadButton.innerHTML = `<i class="fa-solid fa-download"></i> 読込`;
                        
                        loadButton.addEventListener('click', () => loadProjectData(username, projectName));
                        
                        item.appendChild(nameSpan);
                        item.appendChild(loadButton);
                        listContainer.appendChild(item);
                    });

                }, 1000);
            }

            // --- プロジェクト読み込み (ダミー) ---
            function loadProjectData(username, projectName) {
                // TODO: loadProject APIを呼び出す
                console.log(`API call: loadProject (user: ${username}, project: ${projectName})`);
                alert(`（ダミー）「${projectName}」を読み込みます。`);
                
                // TODO: 取得したCSVデータをlocalStorageに保存し、edit.htmlに遷移
                // localStorage.setItem('bloSkeDraft', JSON.stringify({ projectName: projectName, blocks: ... }));
                // window.location.href = 'edit.html';
            }
        });
    </script>
</body>
</html>
